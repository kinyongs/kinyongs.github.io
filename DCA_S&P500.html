<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>S&P500 ì ë¦½ì‹ íˆ¬ì ì‹œë®¬ë ˆì´ì…˜ (ì‹¤ì œ ì›”ê°„ ìˆ˜ìµë¥ )</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body {
    font-family: 'Noto Sans KR', sans-serif;
    background-color: #f0f2f5;
    padding: 20px;
    color: #333;
  }
  .card {
      max-width: 900px;
      margin: 40px auto 40px auto;  /* ìœ„, ì¢Œìš°, ì•„ë˜ margin */
      background: #fff;
      padding: 2rem;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
  h1 {
    text-align: center;
  }
  label {
    font-weight: 600;
  }
  input {
    padding: 5px;
    font-size: 1rem;
    width: 150px;
    margin-right: 10px;
  }
  canvas {
    margin-top: 30px;
  }

  table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 1rem;
  font-size: 0.95rem;
  text-align: center;  /* ì¶”ê°€ */
}
th, td {
  border: 1px solid #ddd;
  padding: 0.5rem;
  text-align: center;  /* ì´ë¯¸ ìˆìœ¼ë©´ OK */
  vertical-align: middle;  /* ì„¸ë¡œ ì¤‘ì•™ ì •ë ¬ */
}

</style>
</head>
<body>
  <div style="text-align: right; margin-bottom: 10px;">
    <a href="index.html" style="font-size: 0.9rem; color: #007bff;">ğŸ  ë©”ì¸ìœ¼ë¡œ</a>
  </div>
  
<div class="card">
  <h1>S&P500 ì ë¦½ì‹ íˆ¬ì ì‹œë®¬ë ˆì´ì…˜</h1>
  <label>íˆ¬ì ê¸°ê°„ (ë…„):
    <input type="number" id="investmentPeriod" value="20">
  </label>
  <button onclick="runSimulation()">ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰</button>

  <canvas id="rollingReturnChart" height="350"></canvas>
  <canvas id="histogramChart" height="350"></canvas>
</div>

<script src="monthly_returns.js"></script>

<script>
let rollingReturnChartInstance = null;
let histogramChartInstance = null;

function runSimulation() {
  const monthlyInvestment = 1;
  const periodYears = parseInt(document.getElementById('investmentPeriod').value);

  const startMonths = Object.keys(monthlyReturns).filter(start => {
    const [year, month] = start.split('-').map(Number);
    const endYear = year + Math.floor((month - 1 + periodYears * 12) / 12);
    return endYear <= 2024;
  });

  const rollingReturns = [];

  startMonths.forEach(start => {
    let principal = 0, value = 0;
    let currentYear = Number(start.split('-')[0]);
    let currentMonth = Number(start.split('-')[1]);

    for (let i = 0; i < periodYears * 12; i++) {
      const key = `${currentYear.toString().padStart(4, '0')}-${currentMonth.toString().padStart(2, '0')}`;
      const monthlyReturn = monthlyReturns[key] !== undefined ? monthlyReturns[key] : 0;

      principal += monthlyInvestment;
      value = value * (1 + monthlyReturn) + monthlyInvestment;

      currentMonth++;
      if (currentMonth > 12) {
        currentMonth = 1;
        currentYear++;
      }
    }

    const cagr = value > 0 && principal > 0 ? Math.pow(value / principal, 1 / periodYears) - 1 : 0;
    rollingReturns.push({ start, cagr });
  });

  const labels = rollingReturns.map(e => e.start);
  const cagrData = rollingReturns.map(e => (e.cagr * 100));

  if (rollingReturnChartInstance) rollingReturnChartInstance.destroy();
  rollingReturnChartInstance = new Chart(document.getElementById('rollingReturnChart'), {
    type: 'line',
    data: {
      labels,
      datasets: [{
        label: 'ì—°í‰ê·  ìˆ˜ìµë¥  (%)',
        data: cagrData,
        borderColor: '#ff7f50',
        tension: 0.3
      }]
    },
    options: {
      responsive: true,
      plugins: {
        title: { display: true, text: 'Rolling Returns (ì‹œì‘ ì›”ë³„)' }
      },
      scales: {
        y: {
          ticks: {
            callback: function(value) { return value.toFixed(2) + '%'; }
          }
        }
      }
    }
  });

  const minCAGR = Math.min(...rollingReturns.map(e => e.cagr));
  const maxCAGR = Math.max(...rollingReturns.map(e => e.cagr));
  const avgCAGR = rollingReturns.reduce((a, b) => a + b.cagr, 0) / rollingReturns.length;

  const bins = {};
  rollingReturns.forEach(e => {
    const rounded = Math.floor(e.cagr * 400) / 4;
    const label = rounded.toFixed(2);
    bins[label] = (bins[label] || 0) + 1;
  });

  const sortedLabels = Object.keys(bins).sort((a, b) => parseFloat(a) - parseFloat(b));

  if (histogramChartInstance) histogramChartInstance.destroy();
  histogramChartInstance = new Chart(document.getElementById('histogramChart'), {
    type: 'bar',
    data: {
      labels: sortedLabels.map(b => b + '%'),
      datasets: [{
        label: 'íšŸìˆ˜',
        data: sortedLabels.map(b => bins[b]),
        backgroundColor: '#6ca0dc'
      }]
    },
    options: {
      responsive: true,
      plugins: {
        title: {
          display: true,
          text: `Rolling Returns ë¶„í¬ (í‰ê·  ${(avgCAGR * 100).toFixed(2)}%, ìµœì†Œ ${(minCAGR * 100).toFixed(2)}%, ìµœëŒ€ ${(maxCAGR * 100).toFixed(2)}%)`
        }
      },
      scales: {
        x: {
          ticks: {
            callback: function(value) {
              const label = this.getLabelForValue(value);
              return label;
            }
          }
        }
      }
    }
  });
}
</script>
<div style="text-align: center; margin-top: 20px;">
  <button onclick="location.href='index.html'" style="padding: 10px 20px; font-size: 1rem; border-radius: 5px; border: none; background-color: #007bff; color: white; cursor: pointer;">
    ğŸ”™ ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°
  </button>
</div>

</body>
</html>