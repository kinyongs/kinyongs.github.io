<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="S&P500 ì§€ìˆ˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ 1ë°°, 2ë°°, 3ë°° ë ˆë²„ë¦¬ì§€ ETFì˜ ìˆ˜ìµë¥ ì„ ì—°ë„ë³„ë¡œ ì‹œë®¬ë ˆì´ì…˜í•˜ê³ , ìˆ˜ìˆ˜ë£Œ ë°˜ì˜ ë° Yì¶• ìŠ¤ì¼€ì¼ ì„¤ì •ì„ í†µí•´ ë‹¤ì–‘í•œ íˆ¬ì ì¡°ê±´ì„ ë¹„êµí•  ìˆ˜ ìˆëŠ” ì‹œê°í™” ë„êµ¬ì…ë‹ˆë‹¤.">
  <title>ğŸ§¨ ë ˆë²„ë¦¬ì§€ ETF íˆ¬ì ì‹œë®¬ë ˆì´ì…˜</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/luxon@3/build/global/luxon.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1"></script>
  <script src="price_daily.js"></script>
</head>
<body>
<div id="nav-placeholder"></div>
<script>
  fetch("includes/nav.html")
    .then(response => response.text())
    .then(data => document.getElementById("nav-placeholder").innerHTML = data);
</script>
    
<div class="card">
  <h1>ğŸ§¨ S&P500 ë ˆë²„ë¦¬ì§€ ETF ì‹œë®¬ë ˆì´ì…˜</h1>
  <p class="note">
    ì„ íƒí•œ ì—°ë„ êµ¬ê°„ ë™ì•ˆ S&P500 ì§€ìˆ˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ<br />
    1ë°°, 2ë°°, 3ë°° ë ˆë²„ë¦¬ì§€ ETFì˜ ëˆ„ì  ìˆ˜ìµë¥ ì„ ì‹œë®¬ë ˆì´ì…˜í•©ë‹ˆë‹¤.<br />
    ìˆ˜ìˆ˜ë£Œ ë°˜ì˜ ì—¬ë¶€ì™€ Yì¶• ìŠ¤ì¼€ì¼ë„ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  </p>
  <section class="inputs">
    <table>
      <tr>
        <th>ì‹œì‘ ì—°ë„</th>
        <td><input type="number" id="startYear" value="1928" /></td>
      </tr>
      <tr>
        <th>ì¢…ë£Œ ì—°ë„</th>
        <td><input type="number" id="endYear" value="2024" /></td>
      </tr>
      <tr>
        <th>ë ˆë²„ë¦¬ì§€ ì„ íƒ</th>
        <td>
          <label><input type="checkbox" class="leverage-check" value="1" checked /> 1ë°°</label><br>
          <label><input type="checkbox" class="leverage-check" value="2" /> 2ë°°</label><br>
          <label><input type="checkbox" class="leverage-check" value="3" /> 3ë°°</label>
        </td>
      </tr>
      <tr>
        <th>ìˆ˜ìˆ˜ë£Œ ë°˜ì˜</th>
        <td>
          <label><input type="radio" name="feeOption" value="no" checked /> ë°˜ì˜ ì•ˆí•¨</label>
          <label><input type="radio" name="feeOption" value="yes" /> ë°˜ì˜í•¨</label>
        </td>
      </tr>
      <tr id="feeInputs" style="display: none;">
        <th>ì—°ê°„ ìˆ˜ìˆ˜ë£Œ (%)</th>
        <td>
          1ë°°: <input type="number" id="fee1x" value="0.03" step="0.01" style="width:60px;" />%, VOO ê¸°ì¤€ <br>
          2ë°°: <input type="number" id="fee2x" value="0.89" step="0.01" style="width:60px;" />%, SSO ê¸°ì¤€ <br>
          3ë°°: <input type="number" id="fee3x" value="0.91" step="0.01" style="width:60px;" />%, UPRO ê¸°ì¤€
        </td>
      </tr>
      <tr>
        <th>Yì¶• ìŠ¤ì¼€ì¼</th>
        <td>
          <label><input type="radio" name="scaleType" value="linear" checked /> ì„ í˜•</label>
          <label><input type="radio" name="scaleType" value="log" /> ë¡œê·¸</label>
        </td>
      </tr>
    </table>
    <div style="text-align: center; margin-top: 15px;">
      <button onclick="runSimulation()">ğŸš€ ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰</button>
    </div>
  </section>
  <div class="chart-wrapper">
    <canvas id="leverageChart"></canvas>
  </div>
  <section id="analysisText" class="note" style="max-width: 800px; margin: 2rem auto;"></section>
</div>

<script>
  document.querySelectorAll('input[name="feeOption"]').forEach(radio => {
    radio.addEventListener('change', () => {
      document.getElementById('feeInputs').style.display =
        document.querySelector('input[name="feeOption"]:checked').value === 'yes' ? 'table-row' : 'none';
    });
  });

  function runSimulation() {
    const startYear = +document.getElementById('startYear').value;
    const endYear = +document.getElementById('endYear').value;
    const scaleType = document.querySelector('input[name="scaleType"]:checked').value;
    const applyFee = document.querySelector('input[name="feeOption"]:checked').value === 'yes';

    const fees = {
      1: +document.getElementById('fee1x').value / 100,
      2: +document.getElementById('fee2x').value / 100,
      3: +document.getElementById('fee3x').value / 100,
    };

    const leverages = [...document.querySelectorAll('.leverage-check:checked')].map(e => +e.value);

    const rawData = Object.entries(priceData)
      .map(([date, price]) => ({ date: new Date(date), price }))
      .filter(d => d.date.getFullYear() >= startYear && d.date.getFullYear() <= endYear)
      .sort((a, b) => a.date - b.date);

    const labels = rawData.map(d => d.date.toISOString().slice(0, 10));

    const results = {};
    leverages.forEach(lv => {
      const feeDaily = applyFee ? Math.pow(1 - fees[lv], 1 / 252) : 1;
      const values = [1];
      for (let i = 1; i < rawData.length; i++) {
        const r = (rawData[i].price / rawData[i - 1].price - 1) * lv;
        values.push(values[i - 1] * (1 + r) * feeDaily);
      }
      results[lv] = values;
    });

    const datasets = leverages.map(lv => ({
      label: `${lv}ë°° ë ˆë²„ë¦¬ì§€`,
      data: results[lv],
      borderWidth: 2,
      pointRadius: 0
    }));

    if (window.leverageChartInstance) window.leverageChartInstance.destroy();
    const ctx = document.getElementById('leverageChart').getContext('2d');
    window.leverageChartInstance = new Chart(ctx, {
      type: 'line',
      data: { labels, datasets },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          x: { type: 'time', time: { unit: 'year' } },
          y: {
            type: scaleType === 'log' ? 'logarithmic' : 'linear',
            beginAtZero: false,
            title: { display: true, text: 'ëˆ„ì  ê°€ì¹˜ (ê¸°ì¤€ = 1)' }
          }
        },
        plugins: {
          title: { display: false, text: 'ğŸ“ˆ ë ˆë²„ë¦¬ì§€ ETF ëˆ„ì  ìˆ˜ìµë¥  ë¹„êµ' }
        }
      }
    });

    const summaries = leverages.map(lv => {
      const end = results[lv].at(-1);
      const ratio = ((end - 1) * 100).toFixed(2);
      return `<p><strong>${lv}ë°° ë ˆë²„ë¦¬ì§€</strong> ìƒí’ˆì€ í•´ë‹¹ ê¸°ê°„ ë™ì•ˆ ëˆ„ì  ìˆ˜ìµë¥ ì´ <strong style="color: #f2c200;">${ratio}%</strong>ë¥¼ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤.</p>`;
    }).join('');
    document.getElementById('analysisText').innerHTML = summaries;
  }

  runSimulation();
</script>
</body>
<script>
  fetch("includes/nav.html")
    .then(res => res.text())
    .then(data => {
      document.getElementById("nav-placeholder").innerHTML = data;

      // â¬‡ï¸ ì£¼ì… í›„ toggle ì´ë²¤íŠ¸ ì—°ê²°
      const toggle = document.getElementById('navToggle');
      const links = document.getElementById('navLinks');
      toggle?.addEventListener('click', () => {
        links?.classList.toggle('active');
      });
    });
</script>
</html>