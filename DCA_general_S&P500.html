<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì ë¦½ì‹ íˆ¬ì ì‹œë®¬ë ˆì´ì…˜ (S&P500 ì§€ìˆ˜ ê¸°ë°˜)</title>
  <meta name="description" content="S&P500 ì§€ìˆ˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ì ë¦½ì‹ íˆ¬ì ì‹œë®¬ë ˆì´ì…˜ ë„êµ¬ì…ë‹ˆë‹¤. ê¸°ê°„ë³„ ìˆ˜ìµë¥ , í‰ê°€ê¸ˆì•¡, íˆ¬ì ì›ê¸ˆì„ ì‹œê°ì ìœ¼ë¡œ ë¶„ì„í•´ë³´ì„¸ìš”.">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css">
  <script src="./price_daily.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<div id="nav-placeholder"></div>
<script>
  fetch("includes/nav.html")
    .then(response => response.text())
    .then(data => {
      document.getElementById("nav-placeholder").innerHTML = data;
    });
</script>

<div class="card">
  <h1>ğŸ“ˆ ì ë¦½ì‹ íˆ¬ì ì‹œë®¬ë ˆì´ì…˜ (S&P500 ì§€ìˆ˜ ê¸°ë°˜)</h1>
  <p class="note">ì‹¤ì œ S&P500 ì§€ìˆ˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ íˆ¬ì ì‹œë®¬ë ˆì´ì…˜ì„ ì§„í–‰í•©ë‹ˆë‹¤.</p>

  <section class="inputs">
    <table>
      <tr>
        <th>ğŸ¦ ì´ˆê¸° íˆ¬ìê¸ˆ (â‚©)</th>
        <td><input type="text" id="initialInvestment" value="0" /></td>
      </tr>
      <tr>
        <th>ğŸ’° ì›” ì ë¦½ ê¸ˆì•¡ (â‚©)</th>
        <td><input type="text" id="monthlyInvestment" value="1,000,000" /></td>
      </tr>
      <tr>
        <th>ğŸ”„ ë§¤ë…„ ì ë¦½ê¸ˆ ì¦ê°€ìœ¨ (%)</th>
        <td><input type="number" id="monthlyIncreaseRate" value="0" /></td>
      </tr>
      <tr>
        <th>ğŸ“… ì‹œì‘ ì—°ë„</th>
        <td><input type="number" id="startYear" value="2015" /> ì²« ê±°ë˜ì¼</td>
      </tr>
      <tr>
        <th>ğŸ“… ì¢…ë£Œ ì—°ë„</th>
        <td><input type="number" id="endYear" value="2024" /> ë§ˆì§€ë§‰ ê±°ë˜ì¼</td>
      </tr>
    </table>

    <div id="errorMsg" class="note" style="color: red;"></div>
    <div style="text-align: center; margin-top: 15px;">
      <button onclick="simulate()">ğŸ“Š ê·¸ë˜í”„ ê·¸ë¦¬ê¸°</button>
    </div>
  </section>

  <section>
    <h3 class="note" style="text-align: center; margin-top: 30px;">ğŸ“Œ ìµœì¢… íˆ¬ì ê²°ê³¼ (ì „ì²´ ê¸°ê°„ ê¸°ì¤€)</h3>
    <table>
      <thead>
        <tr>
          <th>ì´ íˆ¬ì ê¸°ê°„ (ë…„)</th>
          <th>íˆ¬ì ì›ê¸ˆ (ì–µ ì›)</th>
          <th>í‰ê°€ ê¸ˆì•¡ (ì–µ ì›)</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td id="finalYear">-</td>
          <td id="finalPrincipal">-</td>
          <td id="finalValue">-</td>
        </tr>
      </tbody>
    </table>
  </section>

  <div class="chart-wrapper">
    <canvas id="chartCanvas"></canvas>
    <div id="resultComment" class="note" style="text-align: center; font-size: 1rem; margin-top: 1.5rem;"></div>
  </div>
</div>

<script>
function formatWithComma(value) {
  return value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}
function formatCurrency(value) {
  return (value / 1e8).toFixed(2);
}

function simulate() {
  const initial = parseInt(document.getElementById('initialInvestment').value.replace(/,/g, '')) || 0;
  const monthly = parseInt(document.getElementById('monthlyInvestment').value.replace(/,/g, '')) || 0;
  const increaseRate = parseFloat(document.getElementById('monthlyIncreaseRate').value) / 100 || 0;
  const startYear = parseInt(document.getElementById('startYear').value);
  const endYear = parseInt(document.getElementById('endYear').value);

  const errorMsg = document.getElementById('errorMsg');
  const resultComment = document.getElementById('resultComment');
  errorMsg.textContent = '';

  const dates = Object.keys(priceData);
  const years = dates.map(d => new Date(d).getFullYear());
  const minYear = Math.min(...years);
  const maxYear = Math.max(...years);

  if (startYear < minYear + 1 || endYear > maxYear - 1 || startYear > endYear) {
    errorMsg.textContent = `âš ï¸ ìœ íš¨í•˜ì§€ ì•Šì€ ê¸°ê°„ì…ë‹ˆë‹¤. (${minYear + 1} ~ ${maxYear - 1} ì‚¬ì´ì˜ ì—°ë„ë§Œ ê°€ëŠ¥)`;
    return;
  }

  const monthlyData = {};
  for (const [date, price] of Object.entries(priceData)) {
    const y = date.substring(0, 4);
    const m = date.substring(0, 7);
    if (y >= startYear && y <= endYear) {
      if (!monthlyData[m]) monthlyData[m] = [];
      monthlyData[m].push(price);
    }
  }

  const monthlyPrices = Object.entries(monthlyData).map(([ym, prices]) => {
    const avg = prices.reduce((a, b) => a + b, 0) / prices.length;
    return { ym, avg };
  }).sort((a, b) => a.ym.localeCompare(b.ym));

  let totalPrincipal = initial;
  let totalValue = initial;
  let mInvest = monthly;
  const points = [];

  for (let i = 0; i < monthlyPrices.length; i++) {
    const { ym, avg } = monthlyPrices[i];
    const priceRatio = i > 0 ? avg / monthlyPrices[i - 1].avg : 1;
    totalValue = totalValue * priceRatio + mInvest;
    totalPrincipal += mInvest;
    if ((i + 1) % 12 === 0) mInvest *= (1 + increaseRate);
    points.push({ ym, principal: totalPrincipal, value: totalValue });
  }

  const last = points.at(-1);
  document.getElementById('finalYear').textContent = `${endYear - startYear + 1}ë…„`;
  document.getElementById('finalPrincipal').textContent = formatCurrency(last.principal);
  document.getElementById('finalValue').textContent = formatCurrency(last.value);
  resultComment.textContent = `ğŸ“Œ ì´ ${endYear - startYear + 1}ë…„ê°„ íˆ¬ìí•œ ì›ê¸ˆì€ ì•½ ${formatCurrency(last.principal)}ì–µ ì›ì´ë©°, í‰ê°€ê¸ˆì•¡ì€ ì•½ ${formatCurrency(last.value)}ì–µ ì›ì…ë‹ˆë‹¤.`;

  const ctx = document.getElementById('chartCanvas').getContext('2d');
  if (window.myChart) window.myChart.destroy();
  window.myChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: points.map(p => p.ym),
      datasets: [
        { label: 'ì´ ì›ê¸ˆ', data: points.map(p => p.principal), borderColor: '#8884d8', borderWidth: 2, tension: 0.4 },
        { label: 'ì´ í‰ê°€ê¸ˆì•¡', data: points.map(p => p.value), borderColor: '#82ca9d', borderWidth: 2, tension: 0.4 }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      layout: { padding: { bottom: 40 } },
      plugins: {
        legend: {
          labels: {
            color: '#f8f9fa',
            font: { size: 13 }
          }
        }
      },
      interaction: { mode: 'index', intersect: false },
      scales: {
        x: {
          title: { display: true, text: 'íˆ¬ì ì›”', color: '#dee2e6' },
          ticks: { color: '#adb5bd' },
          grid: { color: '#333' }
        },
        y: {
          title: { display: true, text: '(ì–µ ì›)', color: '#dee2e6' },
          ticks: { callback: v => formatCurrency(v), color: '#adb5bd' },
          grid: { color: '#333' }
        }
      }
    }
  });
}

['initialInvestment', 'monthlyInvestment'].forEach(id => {
  const input = document.getElementById(id);
  input.addEventListener('input', () => {
    const numeric = input.value.replace(/[^0-9]/g, '');
    input.value = formatWithComma(numeric);
  });
});

window.addEventListener('DOMContentLoaded', simulate);
</script>

</body>
<script>
  fetch("includes/nav.html")
    .then(res => res.text())
    .then(data => {
      document.getElementById("nav-placeholder").innerHTML = data;

      // â¬‡ï¸ ì£¼ì… í›„ toggle ì´ë²¤íŠ¸ ì—°ê²°
      const toggle = document.getElementById('navToggle');
      const links = document.getElementById('navLinks');
      toggle?.addEventListener('click', () => {
        links?.classList.toggle('active');
      });
    });
</script>
</html>
